{"ast":null,"code":"import _regeneratorRuntime from\"D:/Rim/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Rim/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Rim/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from\"react\";import axios from\"axios\";import{useCallback,useMemo,useReducer,useEffect,useState}from\"react\";import*as SC from\"./style\";/* import TodoApp from \"./TodoApp\"; */import{SearchForm}from\"./SearchForm\";import{List}from\"./List\";import{LastSearches}from\"./LastSearches\";import{usePersistentState}from\"./hooks/Custom Hook\";import storiesReducer from\"./reducers\";//https://hn.algolia.com/api Hacker News API\nimport{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var API_BASE=\"https://hn.algolia.com/api/v1\";var API_SEARCH=\"/search\";var PARAM_SEARCH=\"query=\";var PARAM_PAGE=\"page=\";var PARAM_PAGESIZE=\"hitsPerPage=\";var pageSize=10;var getUrl=function getUrl(searchTerm,page){return\"\".concat(API_BASE).concat(API_SEARCH,\"?\").concat(PARAM_SEARCH).concat(searchTerm,\"&\").concat(PARAM_PAGE).concat(page,\"&\").concat(PARAM_PAGESIZE).concat(pageSize);};var extractSearchTerm=function extractSearchTerm(url){return url.substring(url.lastIndexOf(\"?\")+1,url.indexOf(\"&\")).replace(PARAM_SEARCH,\"\");};var App=function App(){var _useReducer=useReducer(storiesReducer,{data:[],isLoading:false,isError:false,page:0}),_useReducer2=_slicedToArray(_useReducer,2),stories=_useReducer2[0],dispatchStories=_useReducer2[1];var _usePersistentState=usePersistentState(\"search\",\"React\"),_usePersistentState2=_slicedToArray(_usePersistentState,2),searchTerm=_usePersistentState2[0],setSearchTerm=_usePersistentState2[1];var _useState=useState([getUrl(searchTerm,0)]),_useState2=_slicedToArray(_useState,2),urls=_useState2[0],setUrls=_useState2[1];var getLastSearches=function getLastSearches(urls){return urls.reduce(function(result,url,index){var searchTerm=extractSearchTerm(url);if(index===0){return result.concat(searchTerm);}var previousSearchTerm=result[result.length-1];if(previousSearchTerm===searchTerm){return result;}else{return result.concat(searchTerm);}},[]).slice(-6).slice(0,-1);};var lastSearchs=getLastSearches(urls);//Fetch data from server\nvar handleFetchStories=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var lastUrl,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatchStories({type:\"STORIES_FETCH_INIT\"});_context.prev=1;lastUrl=urls[urls.length-1];_context.next=5;return axios.get(lastUrl);case 5:result=_context.sent;dispatchStories({type:\"STORIES_FETCH_SUCCESS\",payload:{list:result.data.hits,page:result.data.page}});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);dispatchStories({type:\"STORIES_FETCH_FAILURE\"});case 12:case\"end\":return _context.stop();}}},_callee,null,[[1,9]]);})),[urls]);useEffect(function(){handleFetchStories();},[handleFetchStories]);var handleRemoveStory=useCallback(function(item){dispatchStories({type:\"REMOVE_STORY\",payload:item});},[]);var handleSearchInput=useCallback(function(e){return setSearchTerm(e.target.value);},[setSearchTerm]);var handleSearchSubmit=function handleSearchSubmit(e){handleSearch(searchTerm,0);e.preventDefault();};var handleLastSearch=function handleLastSearch(searchTerm){handleSearch(searchTerm,0);setSearchTerm(searchTerm);};var handleSearch=useCallback(function(searchTerm,page){var url=getUrl(searchTerm,page);setUrls(urls.concat(url));},[urls]);var handleMore=function handleMore(){var lastUrl=urls[urls.length-1];var searchTerm=extractSearchTerm(lastUrl);handleSearch(searchTerm,stories.page+1);};//useMemo get sum ... of stories\nvar getSumComments=function getSumComments(stories){return stories.data.reduce(function(result,value){return result+value.num_comments;},0);};var sumComments=useMemo(function(){return getSumComments(stories);},[stories]);return/*#__PURE__*/_jsxs(SC.StyledContainer,{children:[/*#__PURE__*/_jsxs(SC.StyledHeadlinePrimary,{children:[\"My Hacker Stories with \",sumComments,\" comments\"]}),/*#__PURE__*/_jsx(SearchForm,{searchTerm:searchTerm,onSearchSubmit:handleSearchSubmit,onSearchInput:handleSearchInput}),/*#__PURE__*/_jsx(LastSearches,{lastSearchs:lastSearchs,onLastSearch:handleLastSearch}),/*#__PURE__*/_jsx(List,{list:stories.data,onRemoveItem:handleRemoveStory}),stories.isError&&/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Oops! Something went wrong...\"})}),stories.isLoading?/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"Loading...\"})}):/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleMore,children:\"More\"})]});};export default App;","map":{"version":3,"sources":["D:/Rim/react-app/src/components/App.js"],"names":["React","axios","useCallback","useMemo","useReducer","useEffect","useState","SC","SearchForm","List","LastSearches","usePersistentState","storiesReducer","API_BASE","API_SEARCH","PARAM_SEARCH","PARAM_PAGE","PARAM_PAGESIZE","pageSize","getUrl","searchTerm","page","extractSearchTerm","url","substring","lastIndexOf","indexOf","replace","App","data","isLoading","isError","stories","dispatchStories","setSearchTerm","urls","setUrls","getLastSearches","reduce","result","index","concat","previousSearchTerm","length","slice","lastSearchs","handleFetchStories","type","lastUrl","get","payload","list","hits","handleRemoveStory","item","handleSearchInput","e","target","value","handleSearchSubmit","handleSearch","preventDefault","handleLastSearch","handleMore","getSumComments","num_comments","sumComments"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport axios from \"axios\";\nimport { useCallback, useMemo, useReducer, useEffect, useState } from \"react\";\nimport * as SC from \"./style\";\n/* import TodoApp from \"./TodoApp\"; */\nimport { SearchForm } from \"./SearchForm\";\nimport { List } from \"./List\";\nimport { LastSearches } from \"./LastSearches\";\nimport { usePersistentState } from \"./hooks/Custom Hook\";\nimport storiesReducer from \"./reducers\";\n\n//https://hn.algolia.com/api Hacker News API\n\nconst API_BASE = \"https://hn.algolia.com/api/v1\";\nconst API_SEARCH = \"/search\";\nconst PARAM_SEARCH = \"query=\";\nconst PARAM_PAGE = \"page=\";\nconst PARAM_PAGESIZE = \"hitsPerPage=\";\nlet pageSize = 10;\nconst getUrl = (searchTerm, page) =>\n  `${API_BASE}${API_SEARCH}?${PARAM_SEARCH}${searchTerm}&${PARAM_PAGE}${page}&${PARAM_PAGESIZE}${pageSize}`;\nconst extractSearchTerm = (url) =>\n  url\n    .substring(url.lastIndexOf(\"?\") + 1, url.indexOf(\"&\"))\n    .replace(PARAM_SEARCH, \"\");\n\nconst App = () => {\n  const [stories, dispatchStories] = useReducer(storiesReducer, {\n    data: [],\n    isLoading: false,\n    isError: false,\n    page: 0,\n  });\n\n  const [searchTerm, setSearchTerm] = usePersistentState(\"search\", \"React\");\n  const [urls, setUrls] = useState([getUrl(searchTerm, 0)]);\n\n  const getLastSearches = (urls) =>\n    urls\n      .reduce((result, url, index) => {\n        const searchTerm = extractSearchTerm(url);\n        if (index === 0) {\n          return result.concat(searchTerm);\n        }\n        const previousSearchTerm = result[result.length - 1];\n        if (previousSearchTerm === searchTerm) {\n          return result;\n        } else {\n          return result.concat(searchTerm);\n        }\n      }, [])\n      .slice(-6)\n      .slice(0, -1);\n\n  const lastSearchs = getLastSearches(urls);\n\n  //Fetch data from server\n  const handleFetchStories = useCallback(async () => {\n    dispatchStories({\n      type: \"STORIES_FETCH_INIT\",\n    });\n\n    try {\n      const lastUrl = urls[urls.length - 1];\n      const result = await axios.get(lastUrl);\n      dispatchStories({\n        type: \"STORIES_FETCH_SUCCESS\",\n        payload: {\n          list: result.data.hits,\n          page: result.data.page,\n        },\n      });\n    } catch {\n      dispatchStories({\n        type: \"STORIES_FETCH_FAILURE\",\n      });\n    }\n  }, [urls]);\n\n  useEffect(() => {\n    handleFetchStories();\n  }, [handleFetchStories]);\n\n  const handleRemoveStory = useCallback((item) => {\n    dispatchStories({\n      type: \"REMOVE_STORY\",\n      payload: item,\n    });\n  }, []);\n\n  const handleSearchInput = useCallback(\n    (e) => setSearchTerm(e.target.value),\n    [setSearchTerm]\n  );\n\n  const handleSearchSubmit = (e) => {\n    handleSearch(searchTerm, 0);\n    e.preventDefault();\n  };\n\n  const handleLastSearch = (searchTerm) => {\n    handleSearch(searchTerm, 0);\n    setSearchTerm(searchTerm);\n  };\n\n  const handleSearch = useCallback(\n    (searchTerm, page) => {\n      const url = getUrl(searchTerm, page);\n      setUrls(urls.concat(url));\n    },\n    [urls]\n  );\n\n  const handleMore = () => {\n    const lastUrl = urls[urls.length - 1];\n    const searchTerm = extractSearchTerm(lastUrl);\n    handleSearch(searchTerm, stories.page + 1);\n  };\n\n  //useMemo get sum ... of stories\n  const getSumComments = (stories) => {\n    return stories.data.reduce(\n      (result, value) => result + value.num_comments,\n      0\n    );\n  };\n\n  const sumComments = useMemo(() => getSumComments(stories), [stories]);\n\n  return (\n    <SC.StyledContainer>\n      {/*  <TodoApp /> */}\n\n      <SC.StyledHeadlinePrimary>\n        My Hacker Stories with {sumComments} comments\n      </SC.StyledHeadlinePrimary>\n\n      <SearchForm\n        searchTerm={searchTerm}\n        onSearchSubmit={handleSearchSubmit}\n        onSearchInput={handleSearchInput}\n      />\n\n      <LastSearches lastSearchs={lastSearchs} onLastSearch={handleLastSearch} />\n\n      <List list={stories.data} onRemoveItem={handleRemoveStory} />\n\n      {stories.isError && (\n        <p>\n          <strong>Oops! Something went wrong...</strong>\n        </p>\n      )}\n\n      {stories.isLoading ? (\n        <p>\n          <strong>Loading...</strong>\n        </p>\n      ) : (\n        <button type=\"button\" onClick={handleMore}>\n          More\n        </button>\n      )}\n    </SC.StyledContainer>\n  );\n};\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}