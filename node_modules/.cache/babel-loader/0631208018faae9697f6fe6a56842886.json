{"ast":null,"code":"import _regeneratorRuntime from\"D:/Rim/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"D:/Rim/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:/Rim/react-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useReducer,useState,useCallback}from\"react\";import{List}from\"./List\";import{AddTodoForm}from\"./AddForm\";import{todoReducer}from\"./reducer\";import axios from\"axios\";import*as SC from\"./style\";import Pagination from\"./Pagination\";import ScrollTopArrow from\"../ScrollTopArrow\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var PageSize=20;var API_ENDPOINT=\"https://jsonplaceholder.typicode.com/todos\";var PARAM_SEARCH=\"_page=\";var PARAM_USERIDSEARCH=\"userId=\";var getUrlByUserId=function getUrlByUserId(searchId,page){return\"\".concat(API_ENDPOINT,\"?\").concat(PARAM_USERIDSEARCH).concat(searchId,\"&\").concat(PARAM_SEARCH).concat(page);};// Storage SearchId Hook\nvar useSemiPersistentState=function useSemiPersistentState(key,initialState){var _useState=useState(localStorage.getItem(key)||initialState),_useState2=_slicedToArray(_useState,2),value=_useState2[0],setValue=_useState2[1];useEffect(function(){localStorage.setItem(key,value);});return[value,setValue];};var TodoApp=function TodoApp(){var _useReducer=useReducer(todoReducer,{data:[],isLoading:false,isError:false}),_useReducer2=_slicedToArray(_useReducer,2),todos=_useReducer2[0],dispatchTodos=_useReducer2[1];var sum_todos=todos.data.length;var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),unCompletedTodo=_useState4[0],setUnCompletedTodo=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),addTodoQuery=_useState6[0],setAddTodoQuery=_useState6[1];var _useState7=useState(1),_useState8=_slicedToArray(_useState7,2),page=_useState8[0],setPage=_useState8[1];var _useSemiPersistentSta=useSemiPersistentState(\"IdSearch\",1),_useSemiPersistentSta2=_slicedToArray(_useSemiPersistentSta,2),searchId=_useSemiPersistentSta2[0],setSearchId=_useSemiPersistentSta2[1];var _useState9=useState([getUrlByUserId(searchId,page)]),_useState10=_slicedToArray(_useState9,2),urls=_useState10[0],setUrls=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),isShowedAll=_useState12[0],setIsShowedAll=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isOver=_useState14[0],setIsOver=_useState14[1];var handleFetchTodos=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var lastUrl,respone;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatchTodos({type:\"TODOS_FETCH_INIT\"});_context.prev=1;lastUrl=urls[urls.length-1];_context.next=5;return axios.get(lastUrl);case 5:respone=_context.sent;if(respone.data.length===0){urls.pop();setIsOver(true);}else if(urls[urls.length-2]===lastUrl){urls.pop();}dispatchTodos({type:\"TODOS_FETCH_SUCCESS\",payload:{list:respone.data,page:page}});_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);dispatchTodos({type:\"TODOS_FETCH_FAILURE\"});case 13:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);})),[urls]);useEffect(function(){return handleFetchTodos();},[handleFetchTodos]);var handleMore=function handleMore(){if(!isShowedAll){var url=getUrlByUserId(searchId,page+1);setUrls(urls.concat(url));}setPage(page+1);};var handleCheckedTodo=function handleCheckedTodo(todo){dispatchTodos({type:todo.completed?\"UNDO_TODO\":\"DO_TODO\",id:todo.id});};var handleRemoveTodo=function handleRemoveTodo(todo){dispatchTodos({type:\"REMOVE_TODO\",payload:todo});};var handleAddTodo=function handleAddTodo(todoQuery){dispatchTodos({type:\"ADD_TODO\",payload:todoQuery});};var handleAddTodoInput=function handleAddTodoInput(e){setAddTodoQuery(e.target.value);};var handleAddTodoSubmit=function handleAddTodoSubmit(e){e.preventDefault();handleAddTodo(addTodoQuery);};var handleCheckboxChange=function handleCheckboxChange(list,e){return dispatchTodos({type:e.target.checked?\"MARK_ALL_TODOS\":\"UNMARK_ALL_TODOS\",payload:list});};var handleSearchIdInput=function handleSearchIdInput(e){setSearchId(e.target.value);};var handleSearchIdSubmit=function handleSearchIdSubmit(e){setPage(1);setIsShowedAll(false);var url=getUrlByUserId(searchId,1);setUrls(urls.concat(url));e.preventDefault();setIsOver(false);};var handleShowAll=function handleShowAll(){setSearchId(\"\");var url=\"\".concat(API_ENDPOINT);setUrls(urls.concat(url));setIsShowedAll(true);setPage(1);setIsOver(false);};useEffect(function(){setUnCompletedTodo(todos.data.filter(function(todo){return todo.completed===false;}).length);},[todos]);var extractSearchId=function extractSearchId(url){return url.substring(url.lastIndexOf(\"?\")+1,url.lastIndexOf(\"&\")).replace(\"userId=\",\"User Id: \");};var getLastSearches=function getLastSearches(urls){return urls.reduce(function(result,url,index){var searchId=extractSearchId(url);if(searchId.includes(\"User Id\")){if(index===0){return result.concat(searchId);}var previousSearchId=result[result.length-1];if(previousSearchId===searchId){return result;}else{return result.concat(searchId);}}else{return result;}},[]).slice(-6).slice(0,-1);};var lastSearches=getLastSearches(urls);var handleLastSearches=function handleLastSearches(searchId){var extractSearchId=searchId.replace(\"User Id: \",\"\");setPage(1);setIsShowedAll(false);var url=getUrlByUserId(extractSearchId,1);setUrls(urls.concat(url));setSearchId(extractSearchId);setIsOver(false);};var _React$useState=React.useState(page),_React$useState2=_slicedToArray(_React$useState,2),currentPage=_React$useState2[0],setCurrentPage=_React$useState2[1];var currentList=React.useMemo(function(){var firstPageIndex=(currentPage-1)*PageSize;var lastPageIndex=firstPageIndex+PageSize;return todos.data.slice(firstPageIndex,lastPageIndex);},[currentPage,todos.data]);console.log(isOver,isShowedAll);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"My Todo App with \",sum_todos,\" works.\"]}),/*#__PURE__*/_jsxs(SC.StyledMessage,{children:[unCompletedTodo,\" Works uncompleted!\"]}),/*#__PURE__*/_jsxs(SC.StyledForm,{className:\"form mb-3\",onSubmit:handleSearchIdSubmit,children:[/*#__PURE__*/_jsx(SC.StyledLabel,{className:\"form-group text-capitalize\",htmlFor:\"IdSearch\",children:\"Search by UserId:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-10\",style:{marginRight:\"-0.75rem\"},children:/*#__PURE__*/_jsx(\"input\",{id:\"IdSearch\",className:\"form-group form-control\",type:\"text\",placeholder:\"Your ID number\",autoFocus:true,onChange:handleSearchIdInput,value:searchId})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-2\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",children:\"Submit\"})})]})]}),/*#__PURE__*/_jsx(\"div\",{children:lastSearches.map(function(searchId,index){return/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){return handleLastSearches(searchId);},className:\"btn btn-dark\",children:searchId},searchId+index);})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary mt-3 mb-2\",onClick:handleShowAll,children:\"Show All User's Works\"}),/*#__PURE__*/_jsx(List,{list:!isShowedAll?todos.data:currentList,onRemoveTodo:handleRemoveTodo,onCheckedTodo:handleCheckedTodo,onCheckboxChange:handleCheckboxChange,UserId:searchId}),todos.isError&&/*#__PURE__*/_jsx(SC.StyledMessage,{children:\"Oops! Something went wrong\"}),todos.isLoading?/*#__PURE__*/_jsx(SC.StyledMessage,{children:\"Loading...\"}):!isShowedAll&!isOver?/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:handleMore,children:\"More\"}):isOver?/*#__PURE__*/_jsx(SC.StyledMessage,{children:\"No more works\"}):/*#__PURE__*/_jsx(Pagination,{onPageChange:function onPageChange(page){setPage(page);setCurrentPage(page);},totalCount:todos.data.length,currentPage:page,pageSize:PageSize}),/*#__PURE__*/_jsx(AddTodoForm,{onAddTodoInput:handleAddTodoInput,onAddTodoSubmit:handleAddTodoSubmit}),/*#__PURE__*/_jsx(ScrollTopArrow,{})]});};export default TodoApp;","map":{"version":3,"sources":["D:/Rim/react-app/src/components/TodoApp/TodoApp.js"],"names":["React","useEffect","useReducer","useState","useCallback","List","AddTodoForm","todoReducer","axios","SC","Pagination","ScrollTopArrow","PageSize","API_ENDPOINT","PARAM_SEARCH","PARAM_USERIDSEARCH","getUrlByUserId","searchId","page","useSemiPersistentState","key","initialState","localStorage","getItem","value","setValue","setItem","TodoApp","data","isLoading","isError","todos","dispatchTodos","sum_todos","length","unCompletedTodo","setUnCompletedTodo","addTodoQuery","setAddTodoQuery","setPage","setSearchId","urls","setUrls","isShowedAll","setIsShowedAll","isOver","setIsOver","handleFetchTodos","type","lastUrl","get","respone","pop","payload","list","handleMore","url","concat","handleCheckedTodo","todo","completed","id","handleRemoveTodo","handleAddTodo","todoQuery","handleAddTodoInput","e","target","handleAddTodoSubmit","preventDefault","handleCheckboxChange","checked","handleSearchIdInput","handleSearchIdSubmit","handleShowAll","filter","extractSearchId","substring","lastIndexOf","replace","getLastSearches","reduce","result","index","includes","previousSearchId","slice","lastSearches","handleLastSearches","currentPage","setCurrentPage","currentList","useMemo","firstPageIndex","lastPageIndex","console","log","marginRight","map"],"mappings":"kZAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,UAA3B,CAAuCC,QAAvC,CAAiDC,WAAjD,KAAoE,OAApE,CACA,OAASC,IAAT,KAAqB,QAArB,CACA,OAASC,WAAT,KAA4B,WAA5B,CACA,OAASC,WAAT,KAA4B,WAA5B,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAO,GAAKC,CAAAA,EAAZ,KAAoB,SAApB,CACA,MAAOC,CAAAA,UAAP,KAAuB,cAAvB,CACA,MAAOC,CAAAA,cAAP,KAA2B,mBAA3B,C,wFAEA,GAAIC,CAAAA,QAAQ,CAAG,EAAf,CACA,GAAMC,CAAAA,YAAY,CAAG,4CAArB,CACA,GAAMC,CAAAA,YAAY,CAAG,QAArB,CACA,GAAMC,CAAAA,kBAAkB,CAAG,SAA3B,CAEA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,QAAD,CAAWC,IAAX,kBAClBL,YADkB,aACFE,kBADE,SACmBE,QADnB,aAC+BH,YAD/B,SAC8CI,IAD9C,GAAvB,CAGA;AACA,GAAMC,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,GAAD,CAAMC,YAAN,CAAuB,CACpD,cAA0BlB,QAAQ,CAACmB,YAAY,CAACC,OAAb,CAAqBH,GAArB,GAA6BC,YAA9B,CAAlC,wCAAOG,KAAP,eAAcC,QAAd,eAEAxB,SAAS,CAAC,UAAM,CACdqB,YAAY,CAACI,OAAb,CAAqBN,GAArB,CAA0BI,KAA1B,EACD,CAFQ,CAAT,CAIA,MAAO,CAACA,KAAD,CAAQC,QAAR,CAAP,CACD,CARD,CAUA,GAAME,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CACpB,gBAA+BzB,UAAU,CAACK,WAAD,CAAc,CACrDqB,IAAI,CAAE,EAD+C,CAErDC,SAAS,CAAE,KAF0C,CAGrDC,OAAO,CAAE,KAH4C,CAAd,CAAzC,4CAAOC,KAAP,iBAAcC,aAAd,iBAMA,GAAMC,CAAAA,SAAS,CAAGF,KAAK,CAACH,IAAN,CAAWM,MAA7B,CACA,eAA8C/B,QAAQ,CAAC,CAAD,CAAtD,yCAAOgC,eAAP,eAAwBC,kBAAxB,eACA,eAAwCjC,QAAQ,CAAC,EAAD,CAAhD,yCAAOkC,YAAP,eAAqBC,eAArB,eACA,eAAwBnC,QAAQ,CAAC,CAAD,CAAhC,yCAAOe,IAAP,eAAaqB,OAAb,eACA,0BAAgCpB,sBAAsB,CAAC,UAAD,CAAa,CAAb,CAAtD,gEAAOF,QAAP,2BAAiBuB,WAAjB,2BACA,eAAwBrC,QAAQ,CAAC,CAACa,cAAc,CAACC,QAAD,CAAWC,IAAX,CAAf,CAAD,CAAhC,0CAAOuB,IAAP,gBAAaC,OAAb,gBACA,gBAAsCvC,QAAQ,CAAC,KAAD,CAA9C,2CAAOwC,WAAP,gBAAoBC,cAApB,gBACA,gBAA4BzC,QAAQ,CAAC,KAAD,CAApC,2CAAO0C,MAAP,gBAAeC,SAAf,gBAEA,GAAMC,CAAAA,gBAAgB,CAAG3C,WAAW,sEAAC,uJACnC4B,aAAa,CAAC,CACZgB,IAAI,CAAE,kBADM,CAAD,CAAb,CADmC,gBAM3BC,OAN2B,CAMjBR,IAAI,CAACA,IAAI,CAACP,MAAL,CAAc,CAAf,CANa,uBAOX1B,CAAAA,KAAK,CAAC0C,GAAN,CAAUD,OAAV,CAPW,QAO3BE,OAP2B,eAQjC,GAAIA,OAAO,CAACvB,IAAR,CAAaM,MAAb,GAAwB,CAA5B,CAA+B,CAC7BO,IAAI,CAACW,GAAL,GACAN,SAAS,CAAC,IAAD,CAAT,CACD,CAHD,IAGO,IAAIL,IAAI,CAACA,IAAI,CAACP,MAAL,CAAc,CAAf,CAAJ,GAA0Be,OAA9B,CAAuC,CAC5CR,IAAI,CAACW,GAAL,GACD,CAEDpB,aAAa,CAAC,CACZgB,IAAI,CAAE,qBADM,CAEZK,OAAO,CAAE,CACPC,IAAI,CAAEH,OAAO,CAACvB,IADP,CAEPV,IAAI,CAAEA,IAFC,CAFG,CAAD,CAAb,CAfiC,iFAuBjCc,aAAa,CAAC,CACZgB,IAAI,CAAE,qBADM,CAAD,CAAb,CAvBiC,qEAAD,GA4BjC,CAACP,IAAD,CA5BiC,CAApC,CA8BAxC,SAAS,CAAC,iBAAM8C,CAAAA,gBAAgB,EAAtB,EAAD,CAA2B,CAACA,gBAAD,CAA3B,CAAT,CAEA,GAAMQ,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CACvB,GAAI,CAACZ,WAAL,CAAkB,CAChB,GAAMa,CAAAA,GAAG,CAAGxC,cAAc,CAACC,QAAD,CAAWC,IAAI,CAAG,CAAlB,CAA1B,CACAwB,OAAO,CAACD,IAAI,CAACgB,MAAL,CAAYD,GAAZ,CAAD,CAAP,CACD,CACDjB,OAAO,CAACrB,IAAI,CAAG,CAAR,CAAP,CACD,CAND,CAQA,GAAMwC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,IAAD,CAAU,CAClC3B,aAAa,CAAC,CACZgB,IAAI,CAAEW,IAAI,CAACC,SAAL,CAAiB,WAAjB,CAA+B,SADzB,CAEZC,EAAE,CAAEF,IAAI,CAACE,EAFG,CAAD,CAAb,CAID,CALD,CAOA,GAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACH,IAAD,CAAU,CACjC3B,aAAa,CAAC,CACZgB,IAAI,CAAE,aADM,CAEZK,OAAO,CAAEM,IAFG,CAAD,CAAb,CAID,CALD,CAOA,GAAMI,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,SAAD,CAAe,CACnChC,aAAa,CAAC,CACZgB,IAAI,CAAE,UADM,CAEZK,OAAO,CAAEW,SAFG,CAAD,CAAb,CAID,CALD,CAOA,GAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,CAAD,CAAO,CAChC5B,eAAe,CAAC4B,CAAC,CAACC,MAAF,CAAS3C,KAAV,CAAf,CACD,CAFD,CAIA,GAAM4C,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACF,CAAD,CAAO,CACjCA,CAAC,CAACG,cAAF,GACAN,aAAa,CAAC1B,YAAD,CAAb,CACD,CAHD,CAKA,GAAMiC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAAChB,IAAD,CAAOY,CAAP,QAC3BlC,CAAAA,aAAa,CAAC,CACZgB,IAAI,CAAEkB,CAAC,CAACC,MAAF,CAASI,OAAT,CAAmB,gBAAnB,CAAsC,kBADhC,CAEZlB,OAAO,CAAEC,IAFG,CAAD,CADc,EAA7B,CAMA,GAAMkB,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACN,CAAD,CAAO,CACjC1B,WAAW,CAAC0B,CAAC,CAACC,MAAF,CAAS3C,KAAV,CAAX,CACD,CAFD,CAIA,GAAMiD,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACP,CAAD,CAAO,CAClC3B,OAAO,CAAC,CAAD,CAAP,CACAK,cAAc,CAAC,KAAD,CAAd,CACA,GAAMY,CAAAA,GAAG,CAAGxC,cAAc,CAACC,QAAD,CAAW,CAAX,CAA1B,CACAyB,OAAO,CAACD,IAAI,CAACgB,MAAL,CAAYD,GAAZ,CAAD,CAAP,CACAU,CAAC,CAACG,cAAF,GACAvB,SAAS,CAAC,KAAD,CAAT,CACD,CAPD,CASA,GAAM4B,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1BlC,WAAW,CAAC,EAAD,CAAX,CACA,GAAMgB,CAAAA,GAAG,WAAM3C,YAAN,CAAT,CACA6B,OAAO,CAACD,IAAI,CAACgB,MAAL,CAAYD,GAAZ,CAAD,CAAP,CACAZ,cAAc,CAAC,IAAD,CAAd,CACAL,OAAO,CAAC,CAAD,CAAP,CACAO,SAAS,CAAC,KAAD,CAAT,CACD,CAPD,CASA7C,SAAS,CAAC,UAAM,CACdmC,kBAAkB,CAChBL,KAAK,CAACH,IAAN,CAAW+C,MAAX,CAAkB,SAAChB,IAAD,QAAUA,CAAAA,IAAI,CAACC,SAAL,GAAmB,KAA7B,EAAlB,EAAsD1B,MADtC,CAAlB,CAGD,CAJQ,CAIN,CAACH,KAAD,CAJM,CAAT,CAMA,GAAM6C,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACpB,GAAD,QACtBA,CAAAA,GAAG,CACAqB,SADH,CACarB,GAAG,CAACsB,WAAJ,CAAgB,GAAhB,EAAuB,CADpC,CACuCtB,GAAG,CAACsB,WAAJ,CAAgB,GAAhB,CADvC,EAEGC,OAFH,CAEW,SAFX,CAEsB,WAFtB,CADsB,EAAxB,CAKA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACvC,IAAD,QACtBA,CAAAA,IAAI,CACDwC,MADH,CACU,SAACC,MAAD,CAAS1B,GAAT,CAAc2B,KAAd,CAAwB,CAC9B,GAAMlE,CAAAA,QAAQ,CAAG2D,eAAe,CAACpB,GAAD,CAAhC,CACA,GAAIvC,QAAQ,CAACmE,QAAT,CAAkB,SAAlB,CAAJ,CAAkC,CAChC,GAAID,KAAK,GAAK,CAAd,CAAiB,CACf,MAAOD,CAAAA,MAAM,CAACzB,MAAP,CAAcxC,QAAd,CAAP,CACD,CAED,GAAMoE,CAAAA,gBAAgB,CAAGH,MAAM,CAACA,MAAM,CAAChD,MAAP,CAAgB,CAAjB,CAA/B,CACA,GAAImD,gBAAgB,GAAKpE,QAAzB,CAAmC,CACjC,MAAOiE,CAAAA,MAAP,CACD,CAFD,IAEO,CACL,MAAOA,CAAAA,MAAM,CAACzB,MAAP,CAAcxC,QAAd,CAAP,CACD,CACF,CAXD,IAWO,CACL,MAAOiE,CAAAA,MAAP,CACD,CACF,CAjBH,CAiBK,EAjBL,EAkBGI,KAlBH,CAkBS,CAAC,CAlBV,EAmBGA,KAnBH,CAmBS,CAnBT,CAmBY,CAAC,CAnBb,CADsB,EAAxB,CAsBA,GAAMC,CAAAA,YAAY,CAAGP,eAAe,CAACvC,IAAD,CAApC,CAEA,GAAM+C,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACvE,QAAD,CAAc,CACvC,GAAM2D,CAAAA,eAAe,CAAG3D,QAAQ,CAAC8D,OAAT,CAAiB,WAAjB,CAA8B,EAA9B,CAAxB,CACAxC,OAAO,CAAC,CAAD,CAAP,CACAK,cAAc,CAAC,KAAD,CAAd,CACA,GAAMY,CAAAA,GAAG,CAAGxC,cAAc,CAAC4D,eAAD,CAAkB,CAAlB,CAA1B,CACAlC,OAAO,CAACD,IAAI,CAACgB,MAAL,CAAYD,GAAZ,CAAD,CAAP,CACAhB,WAAW,CAACoC,eAAD,CAAX,CACA9B,SAAS,CAAC,KAAD,CAAT,CACD,CARD,CAUA,oBAAsC9C,KAAK,CAACG,QAAN,CAAee,IAAf,CAAtC,oDAAOuE,WAAP,qBAAoBC,cAApB,qBACA,GAAMC,CAAAA,WAAW,CAAG3F,KAAK,CAAC4F,OAAN,CAAc,UAAM,CACtC,GAAMC,CAAAA,cAAc,CAAG,CAACJ,WAAW,CAAG,CAAf,EAAoB7E,QAA3C,CACA,GAAMkF,CAAAA,aAAa,CAAGD,cAAc,CAAGjF,QAAvC,CACA,MAAOmB,CAAAA,KAAK,CAACH,IAAN,CAAW0D,KAAX,CAAiBO,cAAjB,CAAiCC,aAAjC,CAAP,CACD,CAJmB,CAIjB,CAACL,WAAD,CAAc1D,KAAK,CAACH,IAApB,CAJiB,CAApB,CAMAmE,OAAO,CAACC,GAAR,CAAYnD,MAAZ,CAAoBF,WAApB,EACA,mBACE,oCACE,0CAAsBV,SAAtB,aADF,cAGE,MAAC,EAAD,CAAI,aAAJ,YAAmBE,eAAnB,yBAHF,cAKE,MAAC,EAAD,CAAI,UAAJ,EAAe,SAAS,CAAC,WAAzB,CAAqC,QAAQ,CAAEsC,oBAA/C,wBACE,KAAC,EAAD,CAAI,WAAJ,EACE,SAAS,CAAC,4BADZ,CAEE,OAAO,CAAC,UAFV,+BADF,cAOE,aAAK,SAAS,CAAC,KAAf,wBACE,YAAK,SAAS,CAAC,QAAf,CAAwB,KAAK,CAAE,CAAEwB,WAAW,CAAE,UAAf,CAA/B,uBACE,cACE,EAAE,CAAC,UADL,CAEE,SAAS,CAAC,yBAFZ,CAGE,IAAI,CAAC,MAHP,CAIE,WAAW,CAAC,gBAJd,CAKE,SAAS,KALX,CAME,QAAQ,CAAEzB,mBANZ,CAOE,KAAK,CAAEvD,QAPT,EADF,EADF,cAYE,YAAK,SAAS,CAAC,OAAf,uBACE,eAAQ,SAAS,CAAC,iBAAlB,oBADF,EAZF,GAPF,GALF,cA8BE,qBACGsE,YAAY,CAACW,GAAb,CAAiB,SAACjF,QAAD,CAAWkE,KAAX,qBAChB,eACE,IAAI,CAAC,QADP,CAEE,OAAO,CAAE,yBAAMK,CAAAA,kBAAkB,CAACvE,QAAD,CAAxB,EAFX,CAGE,SAAS,CAAC,cAHZ,UAMGA,QANH,EAIOA,QAAQ,CAAGkE,KAJlB,CADgB,EAAjB,CADH,EA9BF,cA2CE,eAAQ,SAAS,CAAC,2BAAlB,CAA8C,OAAO,CAAET,aAAvD,mCA3CF,cA+CE,KAAC,IAAD,EACE,IAAI,CAAE,CAAC/B,WAAD,CAAeZ,KAAK,CAACH,IAArB,CAA4B+D,WADpC,CAEE,YAAY,CAAE7B,gBAFhB,CAGE,aAAa,CAAEJ,iBAHjB,CAIE,gBAAgB,CAAEY,oBAJpB,CAKE,MAAM,CAAErD,QALV,EA/CF,CAuDGc,KAAK,CAACD,OAAN,eACC,KAAC,EAAD,CAAI,aAAJ,yCAxDJ,CA2DGC,KAAK,CAACF,SAAN,cACC,KAAC,EAAD,CAAI,aAAJ,yBADD,CAEG,CAACc,WAAD,CAAe,CAACE,MAAhB,cACF,eAAQ,SAAS,CAAC,iBAAlB,CAAoC,OAAO,CAAEU,UAA7C,kBADE,CAIAV,MAAM,cACR,KAAC,EAAD,CAAI,aAAJ,4BADQ,cAGR,KAAC,UAAD,EACE,YAAY,CAAE,sBAAC3B,IAAD,CAAU,CACtBqB,OAAO,CAACrB,IAAD,CAAP,CACAwE,cAAc,CAACxE,IAAD,CAAd,CACD,CAJH,CAKE,UAAU,CAAEa,KAAK,CAACH,IAAN,CAAWM,MALzB,CAME,WAAW,CAAEhB,IANf,CAOE,QAAQ,CAAEN,QAPZ,EApEJ,cA+EE,KAAC,WAAD,EACE,cAAc,CAAEqD,kBADlB,CAEE,eAAe,CAAEG,mBAFnB,EA/EF,cAoFE,KAAC,cAAD,IApFF,GADF,CAwFD,CA/PD,CAgQA,cAAezC,CAAAA,OAAf","sourcesContent":["import React, { useEffect, useReducer, useState, useCallback } from \"react\";\r\nimport { List } from \"./List\";\r\nimport { AddTodoForm } from \"./AddForm\";\r\nimport { todoReducer } from \"./reducer\";\r\nimport axios from \"axios\";\r\nimport * as SC from \"./style\";\r\nimport Pagination from \"./Pagination\";\r\nimport ScrollTopArrow from \"../ScrollTopArrow\";\r\n\r\nlet PageSize = 20;\r\nconst API_ENDPOINT = \"https://jsonplaceholder.typicode.com/todos\";\r\nconst PARAM_SEARCH = \"_page=\";\r\nconst PARAM_USERIDSEARCH = \"userId=\";\r\n\r\nconst getUrlByUserId = (searchId, page) =>\r\n  `${API_ENDPOINT}?${PARAM_USERIDSEARCH}${searchId}&${PARAM_SEARCH}${page}`;\r\n\r\n// Storage SearchId Hook\r\nconst useSemiPersistentState = (key, initialState) => {\r\n  const [value, setValue] = useState(localStorage.getItem(key) || initialState);\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem(key, value);\r\n  });\r\n\r\n  return [value, setValue];\r\n};\r\n\r\nconst TodoApp = () => {\r\n  const [todos, dispatchTodos] = useReducer(todoReducer, {\r\n    data: [],\r\n    isLoading: false,\r\n    isError: false,\r\n  });\r\n\r\n  const sum_todos = todos.data.length;\r\n  const [unCompletedTodo, setUnCompletedTodo] = useState(0);\r\n  const [addTodoQuery, setAddTodoQuery] = useState(\"\");\r\n  const [page, setPage] = useState(1);\r\n  const [searchId, setSearchId] = useSemiPersistentState(\"IdSearch\", 1);\r\n  const [urls, setUrls] = useState([getUrlByUserId(searchId, page)]);\r\n  const [isShowedAll, setIsShowedAll] = useState(false);\r\n  const [isOver, setIsOver] = useState(false);\r\n\r\n  const handleFetchTodos = useCallback(async () => {\r\n    dispatchTodos({\r\n      type: \"TODOS_FETCH_INIT\",\r\n    });\r\n\r\n    try {\r\n      const lastUrl = urls[urls.length - 1];\r\n      const respone = await axios.get(lastUrl);\r\n      if (respone.data.length === 0) {\r\n        urls.pop();\r\n        setIsOver(true);\r\n      } else if (urls[urls.length - 2] === lastUrl) {\r\n        urls.pop();\r\n      }\r\n\r\n      dispatchTodos({\r\n        type: \"TODOS_FETCH_SUCCESS\",\r\n        payload: {\r\n          list: respone.data,\r\n          page: page,\r\n        },\r\n      });\r\n    } catch {\r\n      dispatchTodos({\r\n        type: \"TODOS_FETCH_FAILURE\",\r\n      });\r\n    }\r\n    // eslint-disable-next-line\r\n  }, [urls]);\r\n\r\n  useEffect(() => handleFetchTodos(), [handleFetchTodos]);\r\n\r\n  const handleMore = () => {\r\n    if (!isShowedAll) {\r\n      const url = getUrlByUserId(searchId, page + 1);\r\n      setUrls(urls.concat(url));\r\n    }\r\n    setPage(page + 1);\r\n  };\r\n\r\n  const handleCheckedTodo = (todo) => {\r\n    dispatchTodos({\r\n      type: todo.completed ? \"UNDO_TODO\" : \"DO_TODO\",\r\n      id: todo.id,\r\n    });\r\n  };\r\n\r\n  const handleRemoveTodo = (todo) => {\r\n    dispatchTodos({\r\n      type: \"REMOVE_TODO\",\r\n      payload: todo,\r\n    });\r\n  };\r\n\r\n  const handleAddTodo = (todoQuery) => {\r\n    dispatchTodos({\r\n      type: \"ADD_TODO\",\r\n      payload: todoQuery,\r\n    });\r\n  };\r\n\r\n  const handleAddTodoInput = (e) => {\r\n    setAddTodoQuery(e.target.value);\r\n  };\r\n\r\n  const handleAddTodoSubmit = (e) => {\r\n    e.preventDefault();\r\n    handleAddTodo(addTodoQuery);\r\n  };\r\n\r\n  const handleCheckboxChange = (list, e) =>\r\n    dispatchTodos({\r\n      type: e.target.checked ? \"MARK_ALL_TODOS\" : \"UNMARK_ALL_TODOS\",\r\n      payload: list,\r\n    });\r\n\r\n  const handleSearchIdInput = (e) => {\r\n    setSearchId(e.target.value);\r\n  };\r\n\r\n  const handleSearchIdSubmit = (e) => {\r\n    setPage(1);\r\n    setIsShowedAll(false);\r\n    const url = getUrlByUserId(searchId, 1);\r\n    setUrls(urls.concat(url));\r\n    e.preventDefault();\r\n    setIsOver(false);\r\n  };\r\n\r\n  const handleShowAll = () => {\r\n    setSearchId(\"\");\r\n    const url = `${API_ENDPOINT}`;\r\n    setUrls(urls.concat(url));\r\n    setIsShowedAll(true);\r\n    setPage(1);\r\n    setIsOver(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    setUnCompletedTodo(\r\n      todos.data.filter((todo) => todo.completed === false).length\r\n    );\r\n  }, [todos]);\r\n\r\n  const extractSearchId = (url) =>\r\n    url\r\n      .substring(url.lastIndexOf(\"?\") + 1, url.lastIndexOf(\"&\"))\r\n      .replace(\"userId=\", \"User Id: \");\r\n\r\n  const getLastSearches = (urls) =>\r\n    urls\r\n      .reduce((result, url, index) => {\r\n        const searchId = extractSearchId(url);\r\n        if (searchId.includes(\"User Id\")) {\r\n          if (index === 0) {\r\n            return result.concat(searchId);\r\n          }\r\n\r\n          const previousSearchId = result[result.length - 1];\r\n          if (previousSearchId === searchId) {\r\n            return result;\r\n          } else {\r\n            return result.concat(searchId);\r\n          }\r\n        } else {\r\n          return result;\r\n        }\r\n      }, [])\r\n      .slice(-6)\r\n      .slice(0, -1);\r\n\r\n  const lastSearches = getLastSearches(urls);\r\n\r\n  const handleLastSearches = (searchId) => {\r\n    const extractSearchId = searchId.replace(\"User Id: \", \"\");\r\n    setPage(1);\r\n    setIsShowedAll(false);\r\n    const url = getUrlByUserId(extractSearchId, 1);\r\n    setUrls(urls.concat(url));\r\n    setSearchId(extractSearchId);\r\n    setIsOver(false);\r\n  };\r\n\r\n  const [currentPage, setCurrentPage] = React.useState(page);\r\n  const currentList = React.useMemo(() => {\r\n    const firstPageIndex = (currentPage - 1) * PageSize;\r\n    const lastPageIndex = firstPageIndex + PageSize;\r\n    return todos.data.slice(firstPageIndex, lastPageIndex);\r\n  }, [currentPage, todos.data]);\r\n\r\n  console.log(isOver, isShowedAll);\r\n  return (\r\n    <div >\r\n      <h1>My Todo App with {sum_todos} works.</h1>\r\n\r\n      <SC.StyledMessage>{unCompletedTodo} Works uncompleted!</SC.StyledMessage>\r\n\r\n      <SC.StyledForm className=\"form mb-3\" onSubmit={handleSearchIdSubmit}>\r\n        <SC.StyledLabel\r\n          className=\"form-group text-capitalize\"\r\n          htmlFor=\"IdSearch\"\r\n        >\r\n          Search by UserId:\r\n        </SC.StyledLabel>\r\n        <div className=\"row\">\r\n          <div className=\"col-10\" style={{ marginRight: \"-0.75rem\" }}>\r\n            <input\r\n              id=\"IdSearch\"\r\n              className=\"form-group form-control\"\r\n              type=\"text\"\r\n              placeholder=\"Your ID number\"\r\n              autoFocus\r\n              onChange={handleSearchIdInput}\r\n              value={searchId}\r\n            />\r\n          </div>\r\n          <div className=\"col-2\">\r\n            <button className=\"btn btn-primary\">Submit</button>\r\n          </div>\r\n        </div>\r\n      </SC.StyledForm>\r\n\r\n      <div>\r\n        {lastSearches.map((searchId, index) => (\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => handleLastSearches(searchId)}\r\n            className=\"btn btn-dark\"\r\n            key={searchId + index}\r\n          >\r\n            {searchId}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      <button className=\"btn btn-primary mt-3 mb-2\" onClick={handleShowAll}>\r\n        Show All User's Works\r\n      </button>\r\n\r\n      <List\r\n        list={!isShowedAll ? todos.data : currentList}\r\n        onRemoveTodo={handleRemoveTodo}\r\n        onCheckedTodo={handleCheckedTodo}\r\n        onCheckboxChange={handleCheckboxChange}\r\n        UserId={searchId}\r\n      />\r\n\r\n      {todos.isError && (\r\n        <SC.StyledMessage>Oops! Something went wrong</SC.StyledMessage>\r\n      )}\r\n\r\n      {todos.isLoading ? (\r\n        <SC.StyledMessage>Loading...</SC.StyledMessage>\r\n      ) : !isShowedAll & !isOver ? (\r\n        <button className=\"btn btn-primary\" onClick={handleMore}>\r\n          More\r\n        </button>\r\n      ) : isOver ? (\r\n        <SC.StyledMessage>No more works</SC.StyledMessage>\r\n      ) : (\r\n        <Pagination\r\n          onPageChange={(page) => {\r\n            setPage(page);\r\n            setCurrentPage(page);\r\n          }}\r\n          totalCount={todos.data.length}\r\n          currentPage={page}\r\n          pageSize={PageSize}\r\n        />\r\n      )}\r\n\r\n      <AddTodoForm\r\n        onAddTodoInput={handleAddTodoInput}\r\n        onAddTodoSubmit={handleAddTodoSubmit}\r\n      />\r\n\r\n      <ScrollTopArrow />\r\n    </div>\r\n  );\r\n};\r\nexport default TodoApp;\r\n"]},"metadata":{},"sourceType":"module"}